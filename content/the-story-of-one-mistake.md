---
title: "Как погибли сервера: история одной ошибки"
---
# Введение

29.12.2024 один анонимный [Minecraft](https://ru.wikipedia.org/wiki/Minecraft)-сервер неожиданно прекратил свою работу, оставив игроков без их любимой игры. Ошибка вызвала масштабные перебои, и [[intbyte]], разрабатывавший часть проекта, обратился ко мне за помощью. Цель этого расследования — выявить причину ошибки, анализируя код на GitHub и два лога, предоставленных мне.

# Как погибли несколько серверов

Добавляя новый сервер в [GravitLauncher](https://gravitlauncher.com/) [[intbyte|пострадавший]] получил самую странную ошибку во всей его истории программирования: 

```java
Exception in thread "main" Fatal server error. Contact administrator
    at pro.gravit.launcher.request.websockets.StdWebSocketService.eventHandle(StdWebSocketService.java:94)
    at pro.gravit.launcher.request.websockets.ClientWebSocketService.onMessage(ClientWebSocketService.java:61)
```

После этого он заметил, что все сервера заказчика крашнулись и больше не запускались, даже после удаления предыдущей конфигурации.
## Первые трудности

Я вызвался помочь великому [[intbyte|интбуте]], сказав, что я пойду анализировать код. Но трудности начались с момента, когда я понял, что никакой строки под номером $94$ вовсе не существует. Зайдя на исходный код этого проекта и найдя нужный [файл](https://github.com/GravitLauncher/Launcher/blob/d26b179006f389b069205aae1b85456ef2461d56/LauncherAPI/src/main/java/pro/gravit/launcher/base/request/websockets/StdWebSocketService.java#L94C17-L94C24) с нужной строкой я с ужасом осознал, что это не то, что нужно. Казалось бы, что может быть проще, чем просто посмотреть нужную строку и начать искать проблему? Но как оказалось эта строка $94$ вовсе не та за кого себя выдаёт. В этой строке значится: `return;`.  Что-то здесь не чисто...

## Великая и ужасная система контроля версий

Пораскинув мозгами, благо их еще не выветрило ледяным зимним ветром, я осознал, что дело то в неправильной версии файла. Хотя до этого стоило додуматься сразу. Задав вопрос [[intbyte|Серафиму]], я узнал, что версия лаунчера, которую использует заказчик 5.2.2. Тут же я вспомнил, что в ошибке указан пакет `pro.gravit.launcher.request.websockets`, а в последней версии кода этот же файл лежит в `pro.gravit.launcher.base.request.websockets`. Маленькая деталь, которая потом еще сыграет свою роль.

Быстро переключившись на гитхаб, я нашел нужную строку кода $94$ и понял, что снова что-то пошло не так, ведь на этой строке написано `} else`. Затем я решил уточнить версию проекта и оказалось, что точно известный только цифры 5.2, а вот последняя неизвестна. Проанализировав код, я сделал вывод, что класс `StdWebSocketService.java` менялся всего 5 раз с начала существование проекта и до версии 5.2.3. Поняв что в версиях от 5.2.1 и до 5.2.3 лежит один и тот же файл, я решил сконцентрироваться на среднем, а именно 5.2.2.

## Ложный катарсис

Поняв, что нужная мне строка не может выдать ошибку, я сделал вывод, что речь идёт либо о строке 93, либо 95. Вот тут то и начался весь бред, который сопровождал меня почти до самого конца. на строке 93 выдавалась ошибка связанная с анализом json, из чего я сделал вывод, что в этом заключается вся проблема и достаточно только отредактировать конфиг. Ох как же я ошибался, но об этом позже. Я расслабился и написал об этом. Но позже я задумался: А что если я не прав?

## Первые последствия

Решил проверить другой исход событий, а именно, что если проблема в строке 95, я понял как же я ошибался.